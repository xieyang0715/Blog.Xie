---
title: "redis大量keys *xxx*的慢查询"
date: 2021-09-17 17:33:41
tags:
- redis
- 生产小经验
---



# 前言

今天开发在链路追踪上查看大量800ms的延迟，通过查询追踪发现redis是响应最慢的500ms. 



通过redis慢日志发现大量的`keys *xxx*`语句，而且在同一s均会发生。

>  引用自: https://learnku.com/articles/25892

Redis 是单线程程序，是按照顺序执行指令的，如果说我们现在正在执行 keys 命令，那么其它指令必须等到当前的 keys 指令执行完了才可以继续，再加上 keys 操作是遍历算法，复杂度是 O (n)，乍一想就知道问题所在了，当实例中数据量过大的时候，Redis 服务可能会卡顿，其余指令可能会延时甚至超时报错....

再者 keys 中没有 offset、limit 参数，如果说满足查询条件的 keys 特别多，那就有点尴尬了，哈哈。

所以说官方的建议是：生产环境屏蔽掉 keys 命令。

————————————————
原文作者：finecho
转自链接：https://learnku.com/articles/25892
版权声明：著作权归作者所有。商业转载请联系作者获得授权，非商业转载请保留以上作者信息和原文链接。



然后阿里云工程师也提供了原因: https://help.aliyun.com/document_detail/107695.html

在业务场景中，无限制地允许命令使用可能带来诸多问题。一些Redis命令会直接清空大量甚至全部数据，例如**flushall**、**flushdb**等；**keys**、**hgetall**等命令的不当使用则会阻塞单线程的Redis服务，降低Redis服务的性能。

为保障业务稳定、高效率地运行，您可以根据实际情况禁用特定的命令，降低业务风险。

<!--more-->
需要搜索使用scan.
