---
title: nginx的网站跨域问题
date: 2020-11-13 07:37:38
tags: 生产小经验
toc: true
---



(index):1 Access to XMLHttpRequest at 'https://h5.youninyouqu.com/web/v1/login' from origin 'https://anchor-web.youninyouqu.com' has been blocked by CORS policy: The 'Access-Control-Allow-Origin' header contains multiple values '*, *', but only one is allowed.

说明是配置了2个Access-Control-Allow-Origin: *

其中一个在后端，一个在nginx, 注意，删除nginx的跨域需要停止nginx重启。

如果仅仅是跨域问题, nginx侧解决方案

```nginx
server {
    listen 80;
    server_name dev-admin-server.youwoyouqu.io;
        location / {                                                                                                                 
            add_header Access-Control-Allow-Origin *;
            add_header Access-Control-Allow-Methods 'GET, POST, OPTIONS';
            add_header Access-Control-Allow-Headers 'DNT,X-Mx-ReqToken,Keep-Alive,User-Agent,X-Requested-With,If-Modified-Since,Cache-Control,Content-Type,Authorization';

            if ($request_method = 'OPTIONS') {
                return 204;
            }
                proxy_pass http://admin-server-0:8080;
            }
        }

}

```



今天开发在跨域时，另一种解决，因为后端响应虽然加了跨域但是还是报错

先删除后端的首部，再加

```bash
server {
	location / {
        proxy_pass  http://http_requests;
        # 将后端传递来的首部隐藏
        proxy_hide_header Access-Control-Allow-Origin;
        # 添加允许跨域的域名
        add_header Access-Control-Allow-Origin https://h5.youninyouqu.com;
        add_header Access-Control-Allow-Credentials true;
        add_header Access-Control-Allow-Methods 'GET, POST, OPTIONS';
        add_header Access-Control-Allow-Headers 'DNT,X-Mx-ReqToken,Keep-Alive,User-Agent,X-Requested-With,If-Modified-Since,Cache-Control,Content-Type,Authorization';
        if ($request_method = 'OPTIONS') {
        return 204;
        }
	} 
}
```

